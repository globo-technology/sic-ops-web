<div class="app-facturas-venta">
  <div class="card">
    <h5 class="card-header"><fa-icon [icon]="['fas', 'file-invoice']"></fa-icon> Facturas de Venta</h5>
    <div class="card-body p-3">

      <div class="text-right mb-0">
        <button type="button" class="btn btn-primary" (click)="isFiltersCollapsed = !isFiltersCollapsed"
                [attr.aria-expanded]="!isFiltersCollapsed" aria-controls="collapseExample">
          <fa-icon [icon]="['fas', 'filter']"></fa-icon>
        </button>
      </div>
      <div id="collapseExample" [ngbCollapse]="isFiltersCollapsed" class="mb-2">
        <form [formGroup]="filterForm" (ngSubmit)="filter()" class="card card-body bg-light">
          <div class="row">
            <div class="col-md-6">
              <app-cliente-filtro formControlName="cliente"></app-cliente-filtro>
              <app-usuario-filtro formControlName="usuario"></app-usuario-filtro>
              <app-producto-filtro formControlName="producto"></app-producto-filtro>
              <app-usuario-filtro formControlName="viajante" [roles]="[rol.VIAJANTE]" [label]="'Viajante'"></app-usuario-filtro>
            </div>
            <div class="col-md-6">
              <app-rango-fecha-filtro formControlName="rangoFecha"></app-rango-fecha-filtro>
              <div class="form-group">
                <label for="tipo_factura">Tipo de Factura</label>
                <select class="form-control" id="tipo_factura" formControlName="tipoFactura">
                  <option></option>
                  <option *ngFor="let tf of tiposFactura" [value]="tf.val">{{ tf.text }}</option>
                </select>
              </div>
              <div class="form-group">
                <label for="nro-pedido">Nº Pedido</label>
                <input type="text" class="form-control" id="nro-pedido" formControlName="nroPedido">
              </div>
              <div class="form-group">
                <label>Nº Factura</label>
                <div class="row">
                  <div class="col-4">
                    <label class="sr-only" for="num-serie">Número de serie</label>
                    <input type="text" class="form-control" id="num-serie" formControlName="numSerie">
                  </div>
                  <div class="col-8">
                    <label class="sr-only" for="num-factura">Número de Factura</label>
                    <input type="text" class="form-control" id="num-factura" formControlName="numFactura">
                  </div>
                </div>
              </div>
              <div class="card card-body bg-light mb-3">
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="ordenar-por">Ordenar Por</span>
                  </div>
                  <select class="custom-select" aria-label="Ordernar por" aria-describedby="ordenar-por" formControlName="ordenarPor">
                    <option *ngFor="let opo of ordenarPorOptions" value="{{ opo.val }}">{{ opo.text }}</option>
                  </select>
                </div>
                <div class="input-group mb-0">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="sentido">Sentido</span>
                  </div>
                  <select class="custom-select" aria-label="Ordernar por" aria-describedby="sentido" formControlName="sentido">
                    <option *ngFor="let so of sentidoOptions" value="{{ so.val }}">{{ so.text }}</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
          <ul class="text-right list-inline mb-0">
            <li class="list-inline-item">
              <button type="submit" class="btn btn-primary"><fa-icon [icon]="['fas', 'search']"></fa-icon></button>
            </li>
            <li class="list-inline-item">
              <button type="button" class="btn btn-outline-secondary" (click)="reset()"><fa-icon [icon]="['fas', 'trash']"></fa-icon></button>
            </li>
          </ul>
        </form>
      </div>
      <!--{{ this.filterForm.value | json }}-->
      <div class="alert alert-info" *ngIf="applyFilters.length">
        Filtros aplicados:
        <ul class="pl-3">
          <li *ngFor="let f of applyFilters">{{ f.label }}: {{ f.value }}</li>
        </ul>
      </div>
      <strong><em>{{ totalElements }} resultado{{ totalElements == 1 ? '': 's' }}.</em></strong>
      <div class="facturas">
        <div *ngFor="let f of facturas" class="factura border-bottom border-top py-2">
          <div class="d-flex flex-row flex-wrap">
            <span class="badge badge-info ml-2 mb-2 px-2 py-1">
              <fa-icon [icon]="['fas', 'calendar']"></fa-icon> {{ f.fecha | date:'dd/MM/yyyy hh:mm' }}
            </span>
            <span class="badge badge-pill badge-light ml-2 mb-2 px-2 py-1">
              {{ f.tipoComprobante }}
            </span>
            <span class="badge badge-dark ml-2 mb-2 px-2 py-1">
              <fa-icon [icon]="['fas', 'hashtag']"></fa-icon> INTERNO: {{ helper.formatNumFactura(f.numSerie, f.numFactura ) }} <!--{{ f.numSerie }}-{{ f.numFactura }}-->
            </span>
            <span class="badge badge-dark ml-2 mb-2 px-2 py-1" *ngIf="f.numSerieAfip">
              <fa-icon [icon]="['fas', 'hashtag']"></fa-icon> AFIP: {{ helper.formatNumFactura(f.numSerieAfip, f.numFacturaAfip) }} <!--{{ f.numSerieAfip }}-{{ f.numFacturaAfip }}-->
            </span>
            <span class="badge badge-secondary ml-2 mb-2 px-2 py-1" *ngIf="f.cae">
              CAE: {{ f.cae }} (vto: {{ f.vencimientoCAE | date:'dd/MM/yyyy hh:mm' }})
            </span>
          </div>
          <div class="px-2 flex-fill">
            <div class="d-flex flex-row flex-wrap">
             <div class="">
                <span class="dato"><span class="column-name">Cliente:&nbsp;</span><span class="column-data">{{ f.nombreFiscalCliente }}</span></span>
                <span class="dato"><span class="column-name">Usuario:&nbsp;</span><span class="column-data">{{ f.nombreUsuario }}</span></span>
                <span class="dato" *ngIf="f.nombreViajante"><span class="column-name">Viajante:&nbsp;</span><span class="column-data">{{ f.nombreViajante }}</span></span>
             </div>
             <div class="">
                <span class="dato"><span class="column-name">Total:&nbsp;</span><span class="column-data total">{{ f.total | currency:'ARS' }}</span></span>
              </div>
            </div>
          </div>
          <div class="text-right flex-fill flex-shrink-0 flex-grow-0">
            <ul class="list-inline mb-0 text-center d-inline-block">
              <!--<li class="list-inline-item">
                <a routerLink="." class="btn btn-primary" ngbPopover="Modificar" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'clipboard']"></fa-icon>
                </a>
              </li>
              <li class="list-inline-item">
                <a routerLink="." href="#" class="btn btn-primary" ngbPopover="Eliminar" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'times']"></fa-icon>
                </a>
              </li>
            </ul>
            <ul class="list-inline mb-0 mt-2 ml-2 text-center d-inline-block">
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-primary" ngbPopover="Ver Facturas" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'clipboard-list']"></fa-icon>
                </a>
              </li>
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-primary" ngbPopover="Facturar" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'clipboard-check']"></fa-icon>
                </a>
              </li>-->
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-primary" ngbPopover="Ver Detalle" triggers="mouseenter:mouseleave" (click)="downloadFacturaPdf(f)">
                  <fa-icon [icon]="['fas', 'bullseye']"></fa-icon>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="text-center mt-2">
          <fa-icon class="spinner-primary" *ngIf="loading" [icon]="['fas', 'circle-notch']" [spin]="true" [size]="'3x'"></fa-icon>
          <button type="button" class="btn btn-primary" (click)="loadMore()" *ngIf="!loading && (page + 1) < totalPages">Mas resultados</button>
        </div>
      </div>
    </div>
  </div>
</div>
