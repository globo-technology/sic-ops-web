<div class="app-pedidos">
  <div class="card">
    <h5 class="card-header"><fa-icon [icon]="['fas', 'clipboard-list']"></fa-icon> Pedidos</h5>
    <div class="card-body p-3">

      <div class="text-right mb-0">
        <button type="button" class="btn btn-outline-primary" (click)="isFiltersCollapsed = !isFiltersCollapsed"
                [attr.aria-expanded]="!isFiltersCollapsed" aria-controls="collapseExample">
          <fa-icon [icon]="['fas', 'filter']"></fa-icon>
        </button>
      </div>
      <div id="collapseExample" [ngbCollapse]="isFiltersCollapsed" class="mb-2">
        <form [formGroup]="filterForm" (ngSubmit)="filter()" class="login-form card card-body bg-light">
          <div class="row">
            <div class="col-md-6">
              <app-cliente-filtro formControlName="idCliente"></app-cliente-filtro>
              <app-usuario-filtro formControlName="idUsuario"></app-usuario-filtro>
              <app-producto-filtro formControlName="idProducto"></app-producto-filtro>
              <app-usuario-filtro formControlName="idViajante" [roles]="[rol.VIAJANTE]" [label]="'Viajante'"></app-usuario-filtro>
            </div>
            <div class="col-md-6">
              <div class="text-center">
                <app-rango-fecha-filtro formControlName="rangoFecha"></app-rango-fecha-filtro>
              </div>
              <div class="form-group">
                <label for="estado">Estado</label>
                <select class="form-control" id="estado" formControlName="estadoPedido">
                  <option></option>
                  <option *ngFor="let e of estados" [value]="e.text">{{ e.text }}</option>
                </select>
              </div>
              <div class="form-group">
                <label for="nro-pedido">NÂº Pedido</label>
                <input type="text" class="form-control" id="nro-pedido" formControlName="nroPedido">
              </div>
            </div>
          </div>

          <!--<div class="form-group">
            <label for="fecha-pedido-desde">Rango Fecha Pedido</label>
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" id="fecha-pedido-desde" formControlName="desde"
                     [displayMonths]="2" [navigation]="'select'" [outsideDays]="'visible'"
                     [showWeekNumbers]="false" ngbDatepicker #dd="ngbDatepicker">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary" (click)="dd.open()" type="button">
                  <fa-icon [icon]="['fas', 'calendar']"></fa-icon>
                </button>
              </div>
            </div>
          </div>-->
          <div class="text-right">
            <button type="submit" class="btn btn-primary">
              <fa-icon [icon]="['fas', 'search']"></fa-icon> Buscar
            </button>
          </div>
        </form>
      </div>

      <div class="pedidos my-2">
        <div *ngFor="let p of pedidos" class="pedido d-flex flex-column flex-sm-row align-items-sm-center border-bottom border-top py-2">
          <div class="d-flex flex-column flex-fill">
            <div class="d-flex flex-row flex-wrap">
            <span class="badge badge-dark ml-2 mb-2 px-2 py-1">
              <fa-icon [icon]="['fas', 'hashtag']"></fa-icon> {{ p.nroPedido }}
            </span>
              <span class="badge badge-info ml-2 mb-2 px-2 py-1">
              <fa-icon [icon]="['fas', 'calendar']"></fa-icon> {{ p.fecha | date:'dd/MM/yyyy hh:mm' }}
            </span>
              <span class="badge ml-2 mb-2 px-2 py-1" [class.badge-success]="getEstadoValue(p.estado) === estado.ABIERTO"
                    [class.badge-danger]="getEstadoValue(p.estado) === estado.CERRADO"
                    [class.badge-warning]="getEstadoValue(p.estado) === estado.ACTIVO">
              {{ p.estado }}
            </span>
            </div>
            <div class="px-2 flex-fill">
              <div class="d-flex flex-row flex-wrap">
                <div class="">
                  <span class="dato"><span class="column-name">Cliente:&nbsp;</span><span class="column-data">{{ p.nombreFiscalCliente }}</span></span>
                  <span class="dato"><span class="column-name">Usuario:&nbsp;</span><span class="column-data">{{ p.nombreUsuario }}</span></span>
                  <span class="dato" *ngIf="p.nombreViajante"><span class="column-name">Viajante:&nbsp;</span><span class="column-data">{{ p.nombreViajante }}</span></span>
                </div>
                <div class="">
                  <span class="dato"><span class="column-name">Total Estimado:&nbsp;</span><span class="column-data total">{{ p.totalEstimado | currency:'ARS' }}</span></span>
                  <span class="dato"><span class="column-name">Total Actual:&nbsp;</span><span class="column-data total">{{ p.totalActual | currency:'ARS' }}</span></span>
                </div>
              </div>
            </div>
          </div>
          <div class="text-right flex-fill flex-shrink-0 flex-grow-0">
            <ul class="list-inline mb-0 text-center d-inline-block">
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-primary" ngbPopover="Modificar" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'clipboard']"></fa-icon>
                </a>
              </li>
              <li class="list-inline-item">
                <a routerLink="." href="#" class="btn btn-danger" ngbPopover="Eliminar" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'times']"></fa-icon>
                </a>
              </li>
            </ul>
            <ul class="list-inline mb-0 mt-2 ml-2 text-center d-inline-block">
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-info" ngbPopover="Ver Facturas" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'clipboard-list']"></fa-icon>
                </a>
              </li>
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-info" ngbPopover="Facturar" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'clipboard-check']"></fa-icon>
                </a>
              </li>
              <li class="list-inline-item">
                <a routerLink="." class="btn btn-info" ngbPopover="Ver Detalle" triggers="mouseenter:mouseleave">
                  <fa-icon [icon]="['fas', 'bullseye']"></fa-icon>
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="text-center mt-2">
          <fa-icon *ngIf="pedidosLoading" [icon]="['fas', 'circle-notch']" [spin]="true" [size]="'3x'"></fa-icon>
          <button type="button" class="btn btn-secondary" (click)="loadMore()" *ngIf="!pedidosLoading && (page + 1) < totalPages">Mas pedidos...</button>
        </div>
      </div>

      <!--<ngb-pagination [collectionSize]="totalElements" [pageSize]="size" [(page)]="page" (pageChange)="pageChange()"
                      [maxSize]="3" [rotate]="true" [ellipses]="false" [boundaryLinks]="true"
                      [disabled]="pedidosLoading" *ngIf="totalPages > 1" class="d-flex justify-content-center"></ngb-pagination>-->

    </div>
  </div>
</div>
