<div class="app-traspasos">
  <div class="d-flex flex-row align-items-center my-3">
    <h1 class="h3 m-0 flex-fill"><fa-icon [icon]="['fas', 'exchange-alt']"></fa-icon> Traspasos</h1>
    <div class="text-right m-0">
      <button type="button" class="btn" (click)="isFiltersCollapsed = !isFiltersCollapsed"
              [attr.aria-expanded]="!isFiltersCollapsed" aria-controls="productosFiltersCollapse"
              [class.btn-outline-primary]="!isFiltersCollapsed" [class.btn-primary]="isFiltersCollapsed"
              ngbPopover="Filtros" triggers="mouseenter:mouseleave" placement="left">
        <fa-icon [icon]="['fas', 'filter']"></fa-icon>
      </button>
    </div>
  </div>
  <div id="productosFiltersCollapse" [ngbCollapse]="isFiltersCollapsed" class="mb-3">
    <ng-template #filterFormFields>
      <div class="row" [formGroup]="filterForm">
        <div class="col-md-6">
          <app-rango-fecha-filtro formControlName="rangoFecha"></app-rango-fecha-filtro>
          <div class="form-group">
            <label for="nro-traspaso">Nº Traspaso</label>
            <input type="text" class="form-control" id="nro-traspaso" formControlName="nroTraspaso">
          </div>
          <div class="form-group">
            <label for="nro-pedido">Nº Pedido</label>
            <input type="text" class="form-control" id="nro-pedido" formControlName="nroPedido">
          </div>
          <app-usuario-filtro formControlName="idUsuario"></app-usuario-filtro>
        </div>
        <div class="col-md-6">
          <div class="card card-body bg-light mb-3">
            <app-filtro-ordenamiento id="filtroOrdenamientoOrdenarPorT" [values]="ordenarPorOptionsT" [label]="'Ordenar Por'" formControlName="ordenarPor" #ordernarPorT></app-filtro-ordenamiento>
            <app-filtro-ordenamiento id="filtroOrdenamientoSentidoT" [values]="sentidoOptionsT" [label]="'Sentido'" formControlName="sentido" #sentidoT></app-filtro-ordenamiento>
          </div>
        </div>
      </div>
    </ng-template>

    <app-filtros-form [form]="filterForm" [fieldsTemplate]="filterFormFields" (filterBtnClick)="filter()" (resetBtnClick)="reset()"></app-filtros-form>
  </div>
  <app-filtros-aplicados [appliedFilters]="appliedFilters" [totalElements]="totalElements"
                         [ordenarPorAplicado]="ordenarPorAplicado" [sentidoAplicado]="sentidoAplicado"></app-filtros-aplicados>
  <div class="traspasos my-2">
    <ng-template #info let-item>
      <div class="d-flex flex-row flex-wrap">
        <span class="badge badge-dark ml-2 mb-2 px-2 py-1">
          <fa-icon [icon]="['fas', 'calendar']"></fa-icon> {{ item.fechaDeAlta | date:'dd/MM/yyyy HH:mm' }}
        </span>
        <span class="badge badge-secondary ml-2 mb-2 px-2 py-1">
          #{{ item.nroTraspaso }}
        </span>
        <span class="badge badge-secondary ml-2 mb-2 px-2 py-1">
          #Pedido: {{ item.nroPedido }}
        </span>
      </div>
      <div class="px-2 flex-fill">
        <div class="d-flex flex-row flex-wrap align-items-center">
          <span class="mr-2"><span class="font-weight-bold">Sucursal Origen:&nbsp;</span><span class="font-italic">{{ item.nombreSucursalOrigen }}</span></span>
          <span class="mr-2"><span class="font-weight-bold">Sucursal Destino:&nbsp;</span><span class="font-italic">{{ item.nombreSucursalDestino }}</span></span>
          <span class="mr-2"><span class="font-weight-bold">Usuario:&nbsp;</span><span class="font-italic">{{ item.nombreUsuario }}</span></span>
        </div>
      </div>
    </ng-template>
    <ng-template #actions let-item>
      <ul class="list-inline mb-0 text-center d-inline-block">
        <li class="list-inline-item">
          <button class="btn btn-primary fake-cursor" ngbPopover="Ver Detalle" placement="left" triggers="mouseenter:mouseleave" (click)="verTraspaso(item)">
            <fa-icon [icon]="['far', 'eye']"></fa-icon>
          </button>
        </li>
      </ul>
    </ng-template>
    <app-lista [items]="items" [infoTemplate]="info" [actionsTemplate]="actions"
               [page]="page" [totalPages]="totalPages" [totalElements]="totalElements" (pageChange)="loadPage($event)"></app-lista>
  </div>
</div>
